#! /bin/sh

VERSION=4.0

# small safety test
if [ ! -f module/pgmodule.c ]
then
	echo "Hmmm.  Are you sure you are in the right directory?"
	exit 1
fi

if [ -f BETA ]
then
	VERSION=$VERSION-pre`date +"%y%m%d"`
	PACKAGE=pygresql.pkg-beta
	SYMLINK=PyGreSQL-beta.tgz
else
	PACKAGE=pygresql.pkg
	SYMLINK=PyGreSQL.tgz
fi

DISTDIR=/usr/ftp/pub/distrib
TD=PyGreSQL-$VERSION
TF=$DISTDIR/$TD.tgz

MODFILES="module/pg.py module/pgdb.py module/pgmodule.c module/setup.py"
DOCFILES="docs/*.txt docs/*.html docs/*.css"
TUTFILES="tutorial/*.py"

echo "Making source tarball..."

./mkdocs

rm -rf $TD
mkdir $TD
mkdir $TD/docs
mkdir $TD/tutorial
cp $MODFILES $TD
cp $DOCFILES $TD/docs
cp $TUTFILES $TD/tutorial
tar -cvzf $TF $TD
chmod 644 $TF
rm -rf $TD
rm -f $DISTDIR/$SYMLINK
ln -s $TD.tgz $DISTDIR/$SYMLINK

echo "$TF has been built"

